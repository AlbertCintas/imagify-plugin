jQuery(function(a){function n(d){d.each(function(){var c=parseInt(a(this).closest(".imagify-chart").next(".imagipercent").text()),c=[{value:c,color:"#00B3D3"},{value:100-c,color:"#D8D8D8"}];(new Chart(a(this)[0].getContext("2d"))).Doughnut(c,{segmentStrokeColor:"#FFF",segmentStrokeWidth:1,animateRotate:!0,tooltipEvents:[]})})}function p(d){d.each(function(){var c=parseInt(a(this).closest(".imagify-ac-chart").attr("data-percent")),c=[{value:c,color:"#40B1D0"},{value:100-c,color:"#FFFFFF"}];(new Chart(a(this)[0].getContext("2d"))).Doughnut(c,
{segmentStrokeColor:"transparent",segmentStrokeWidth:0,animateRotate:!0,animation:!0,percentageInnerCutout:70,tooltipEvents:[]})})}var l={log:function(a){"undefined"!==console&&console.log(a)}},e=document.getElementById("imagify-overview-chart"),q=[{value:imagifyBulk.totalUnoptimizedAttachments,color:"#D9E4EB",highlight:"#D9E4EB",label:imagifyBulk.overviewChartLabels.unoptimized},{value:imagifyBulk.totalOptimizedAttachments,color:"#46B1CE",highlight:"#46B1CE",label:imagifyBulk.overviewChartLabels.optimized},
{value:imagifyBulk.totalErrorsAttachments,color:"#2E3242",highlight:"#2E3242",label:imagifyBulk.overviewChartLabels.error}];if(e){var f=(new Chart(e.getContext("2d"))).Doughnut(q,{segmentStrokeColor:"transparent",segmentStrokeWidth:0,animateRotate:!0,animation:!0,percentageInnerCutout:85,legendTemplate:'<ul class="imagify-<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>',
tooltipTemplate:"<%= value %>"}),e=f.generateLegend();document.getElementById("imagify-overview-chart-legend").innerHTML=e}a("#imagify-simulate-bulk-action").click(function(d){d.preventDefault();a("#imagify-bulk-action").trigger("click")});a("#imagify-bulk-action").click(function(){var d=a(this);if(d.attr("disabled"))return!1;d.attr("disabled","disabled");d.find(".dashicons").addClass("rotate");confirmMessage=function(){return"Imagify is processing. Are your sure you want to quit this page?"};a(window).on("beforeunload",
confirmMessage);a.get(ajaxurl+"?action=imagify_get_unoptimized_attachment_ids&imagifybulkuploadnonce="+a("#imagifybulkuploadnonce").val()).done(function(c){if(c.success){c={lib:ajaxurl+"?action=imagify_bulk_upload&imagifybulkuploadnonce="+a("#imagifybulkuploadnonce").val(),images:c.data};var e=a(".imagify-bulk-table table tbody"),g=0,m=0,h=0,k=0;a(".imagify-row-progress").slideDown();a(".imagify-no-uploaded-yet, .imagify-row-complete").hide(200);Optimizer=new ImagifyGulp(c);Optimizer.before(function(a){e.append('<tr id="attachment-'+
a.id+'"><td class="imagify-cell-filename"><span class="imagiuploaded"><img src="'+a.thumbnail+'"/>"</span><span class="imagifilename">'+a.filename+'</span></td><td class="imagify-cell-status"><span class="imagistatus status-compressing"><span class="dashicons dashicons-admin-generic rotate"></span>Compressing<span></span></span></td><td class="imagify-cell-original"></td><td class="imagify-cell-optimized"></td><td class="imagify-cell-percentage"></td><td class="imagify-cell-thumbnails"></td><td class="imagify-cell-savings"></td></tr>')}).each(function(b){var c=
a("#imagify-progress-bar");c.css({width:b.progress+"%"});c.find(".percent").html(b.progress+"%");b.success?(a("#attachment-"+b.image+" .imagify-cell-status").html('<span class="imagistatus status-complete"><span class="dashicons dashicons-yes"></span>Complete</span>'),a("#attachment-"+b.image+" .imagify-cell-original").html(b.original_size_human),a("#attachment-"+b.image+" .imagify-cell-optimized").html(b.new_size_human),a("#attachment-"+b.image+" .imagify-cell-percentage").html('<span class="imagify-chart"><span class="imagify-chart-container"><canvas height="18" width="18" id="imagify-consumption-chart" style="width: 18px; height: 18px;"></canvas></span></span><span class="imagipercent">'+
b.percent+"</span>%"),n(a("#attachment-"+b.image+" .imagify-cell-percentage").find("canvas")),a("#attachment-"+b.image+" .imagify-cell-thumbnails").html(b.thumbnails),a("#attachment-"+b.image+" .imagify-cell-savings").html(Optimizer.toHumanSize(b.overall_saving,1)),a("#imagify-overview-chart-percent").html(b.global_optimized_attachments_percent+"<span>%</span>"),a("#imagify-total-optimized-attachments").html(b.global_optimized_attachments),a("#imagify-unconsumed-percent").html(b.global_unconsumed_quota+
"%"),a("#imagify-unconsumed-bar").animate({width:b.global_unconsumed_quota+"%"}),a("#imagify-original-bar").find(".imagify-barnb").html(b.global_original_human),a("#imagify-optimized-bar").animate({width:b.global_optimized_percent+"%"}),a("#imagify-optimized-bar").find(".imagify-barnb").html(b.global_optimized_human),g=g+b.thumbnails+1,a(".imagify-cell-nb-files").html(g+" file(s)"),h+=b.original_overall_size,a(".imagify-total-original").html(Optimizer.toHumanSize(h,1)),k+=b.overall_saving,a(".imagify-total-gain").html(Optimizer.toHumanSize(k,
1))):(a("#attachment-"+b.image).after('<tr><td colspan="7"><span class="status-error">'+b.error+"</span></td></tr>"),a("#attachment-"+b.image+" .imagify-cell-status").html('<span class="imagistatus status-error"><span class="dashicons dashicons-dismiss"></span>Error</span>'),m++,a(".imagify-cell-errors").html(m+" error(s)"));f.segments[0].value=b.global_unoptimized_attachments;f.segments[1].value=b.global_optimized_attachments;f.segments[2].value=b.global_errors_attachments;f.update()}).done(function(b){d.removeAttr("disabled");
d.find(".dashicons").removeClass("rotate");a(window).off("beforeunload",confirmMessage);a(".imagify-row-progress").slideUp();"NaN"!==b.global_percent&&(a(".imagify-row-complete").removeClass("hidden").addClass("done").attr("aria-hidden","false"),a("html, body").animate({scrollTop:a(".imagify-row-complete").offset().top},200),a(".imagify-ac-rt-total-gain").html(b.global_gain_human),a(".imagify-ac-rt-total-original").html(b.global_original_size_human),text2share=imagifyBulk.textToShare,text2share=text2share.replace("%1$s",
b.global_gain_human),text2share=text2share.replace("%2$s",b.global_original_size_human),text2share=encodeURIComponent(text2share),a(".imagify-sn-twitter").attr("href","https://twitter.com/intent/tweet?source=webclient&amp;original_referer="+imagifyBulk.pluginURL+"&amp;text="+text2share+"&amp;url="+imagifyBulk.pluginURL+"&amp;related=imagify&amp;hastags=performance,web,wordpress"),a(".imagify-ac-chart").attr("data-percent",b.global_percent),p(a(".imagify-ac-chart").find("canvas")))}).error(function(a){l.log("Can't optimize image with id "+
a)}).run()}else d.removeAttr("disabled"),d.find(".dashicons").removeClass("rotate"),a(window).off("beforeunload",confirmMessage),l.log(c),"over-quota"==c.data.message&&swal({title:imagifyBulk.overQuotaTitle,text:imagifyBulk.overQuotaText,type:"error",customClass:"imagify-sweet-alert",html:!0}),"no-images"==c.data.message&&swal({title:imagifyBulk.noAttachmentToOptimizeTitle,text:imagifyBulk.noAttachmentToOptimizeText,type:"info",customClass:"imagify-sweet-alert"})})})});var width=700,height=290;
if(window.innerWidth)var clientLeft=(window.innerWidth-width)/2,clientTop=(window.innerHeight-height)/2;else clientLeft=(document.body.clientWidth-width)/2,clientTop=(document.body.clientHeight-height)/2;[].forEach.call(document.querySelectorAll(".imagify-share-networks a"),function(a){a.addEventListener("click",function(a){window.open(this.href,"","status=no, scrollbars=no, menubar=no, top="+clientTop+", left="+clientLeft+", width="+width+", height="+height);a.preventDefault()},!1)});