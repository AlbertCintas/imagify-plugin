var ImagifyGulp;ImagifyGulp=function(){function a(a){var b,c;return this.cnf=a,this.images=[],this.current_image_id=0,this.total_original_size=0,this.total_optimized_size=0,this.total_gain=0,this.total_percent=0,this.global_original_size=0,this.global_optimized_size=0,this.global_gain=0,this.global_percent=0,this.callbackEach=function(){},this.callbackBefore=function(){},this.callbackError=function(){},this.callbackDone=function(){},this.images=function(){var a,d;a=this.cnf.images,d=[];for(c in a)b=a[c],d.push(c);return d}.call(this),this.total_images=this.images.length,this.total_images?this:!1}return a.prototype.run=function(){return this.loop(),this},a.prototype.toHumanSize=function(a,b,c){var d,e;return null==b&&(b=1),null==c&&(c=!0),0===a?"0"+(c===!0?"kb":""):(e=["b","kb","mb"],d=parseInt(Math.floor(Math.log(a)/Math.log(1024))),(a/Math.pow(1024,d)).toFixed(b)+e[d])},a.prototype.each=function(a){return this.callbackEach=a,this},a.prototype.before=function(a){return this.callbackBefore=a,this},a.prototype.error=function(a){return this.callbackError=a,this},a.prototype.done=function(a){return this.callbackDone=a,this},a.prototype.createThumb=function(a,b){var c,d;return d=this,c=new Image,c.onload=function(){var a,e,f,g,h,i,j,k,l;return i=33,h=33,g=c.width,f=c.height,f>g?(l=i/g,k=i,j=f*l):(l=h/f,j=h,k=g*l),a=document.createElement("canvas"),a.width=k,a.height=j,c.width=k,c.height=j,e=a.getContext("2d"),e.drawImage(this,0,0,k,j),b.thumbnail=a.toDataURL("image/jpeg"),d.callbackBefore(b),d.send()},c.src=a},a.prototype.loop=function(){var a,b;return this.current_image=parseInt(this.images[this.current_image_id]),b=this.cnf.images[this.current_image],a=b.split("/").pop(),this.createThumb(b,{id:this.current_image,filename:a})},a.prototype.send=function(){var a,b;return a=this,b=new XMLHttpRequest,b.onreadystatechange=function(){var b,c,d;return 4===this.readyState?(c=JSON.parse(this.responseText),b=c.data,d={success:b.success,image:a.current_image,progress:Math.floor((a.current_image_id+1)/a.images.length*100),global_optimized_attachments:b.global_optimized_attachments,global_unoptimized_attachments:b.global_unoptimized_attachments,global_errors_attachments:b.global_errors_attachments,global_optimized_percent:b.global_optimized_percent},b.success!==!1?(a.total_original_size+=b.original_size,a.total_optimized_size+=b.new_size,a.total_gain+=b.original_size-b.new_size,a.total_percent=(a.total_optimized_size/a.total_original_size*100).toFixed(2),a.global_original_size+=b.original_overall_size,a.global_optimized_size+=b.new_overall_size,a.global_gain+=b.overall_saving,a.global_percent=(100-a.global_optimized_size/a.global_optimized_size*100).toFixed(2),d.original_size_human=a.toHumanSize(b.original_size),d.new_size_human=a.toHumanSize(b.new_size),d.percent=(100-b.new_size/b.original_size*100).toFixed(2),d.thumbnails=b.thumbnails,d.global_optimized_attachments_percent=b.global_optimized_attachments_percent,d.global_optimized_human=b.global_optimized_human,d.global_unconsumed_quota=b.global_unconsumed_quota,d.global_original_human=b.global_original_human,d.overall_saving=b.overall_saving,d.original_overall_size=b.original_overall_size):d.error=b.error,a.callbackEach(d),a.current_image_id++,a.current_image_id>=a.images.length?a.callbackDone({global_original_size_human:a.toHumanSize(a.global_original_size),global_gain_human:a.toHumanSize(a.global_gain),global_percent:(100-100*(a.global_optimized_size/a.global_original_size)).toFixed(2)}):a.loop()):void 0},b.open("POST",this.cnf.lib,!0),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send("image="+a.current_image),this},a}();
//# sourceMappingURL=imagify.min.js.map